verifiedTag = '<span class="verified" title="Verified account"><i class="far fa-check-circle"></i></span>';
let tag = document.querySelector("html");
var goTopBtn = document.querySelector("#gotopbtn");

function scrollFunction() {
    let limit = 200;
    tag.scrollTop > 200 || document.documentElement.scrollTop > 200 ? (goTopBtn.style.visibility = "visible", goTopBtn.style.opacity = "1") : (goTopBtn.style.visibility = "hidden", goTopBtn.style.opacity = "0")
}

function topFunction() { tag.scrollTop = 0, document.documentElement.scrollTop = 0 }

function more(e) { postid = $(e).parent().parent().attr("data-post-id"), opt = $("div[data-post-id=" + postid + "] .options"), "none" == opt.css("display") ? opt.show(300) : opt.hide(300) }

function like(e) { postid = $(e).parent().parent().attr("data-post-id"), url = "/1/" + postid + "", $.post(url, res => { console.log("likes status => ", res.status), c = $(".likes" + postid)[0], d = $(".dislikes" + postid)[0], f = $("div[data-post-id=" + postid + "] .dislike"), 0 === res.status ? (message = 'You should login for this <a href="/login">Let\'s login</a>', popup(message, "auto", "warning", 3e3)) : 1 === res.status ? (c.innerHTML = Number(c.textContent) + 1, e.src = "/img/arrow2.svg") : 2 === res.status ? (c.innerHTML = Number(c.textContent) - 1, e.src = "/img/arrow.svg") : 3 === res.status ? (c.innerHTML = Number(c.textContent) + 1, d.innerHTML = Number(d.textContent) - 1, e.src = "/img/arrow2.svg", f.attr("src", "/img/arrow.svg")) : console.log("else1 => ", res.status) }) }

function dislike(e) { postid = $(e).parent().parent().attr("data-post-id"), url = "/2/" + postid + "", $.post(url, res => { d = $(".dislikes" + postid)[0], c = $(".likes" + postid)[0], f = $("div[data-post-id=" + postid + "] .like"), 0 === res.status ? (message = 'You should login for this <a href="/login">Let\'s login</a>', popup(message, "auto", "warning", 3e3)) : 1 === res.status ? (d.innerHTML = Number(d.textContent) + 1, e.src = "/img/arrow2.svg") : 2 === res.status ? (d.innerHTML = Number(d.textContent) - 1, e.src = "/img/arrow.svg") : 3 === res.status ? (d.innerHTML = Number(d.textContent) + 1, c.innerHTML = Number(c.textContent) - 1, e.src = "/img/arrow2.svg", f.attr("src", "/img/arrow.svg")) : console.log("else2 => ", res.status) }) }

function send(e) { postid = $(e).parent().parent().parent().attr("data-post-id"), message = $("div[data-post-id=" + postid + "] input[type=text]").val() || "", url = "/3/" + postid + "", c = $("div[data-post-id=" + postid + "] .comments"), message.length > 0 ? (data = { message: message }, commentcount = $("div[data-post-id=" + postid + "] .c"), $.post(url, data, res => { input = $("div[data-post-id=" + postid + "] input[type=text]"), console.log("isverified > ", res.isverified), 0 === res.status ? (message = 'You should login for this <a href="/login">Let\'s login</a>', popup(message, "auto", "warning", 3e3)) : 1 === res.status ? (res.isverified ? comment = '<div class="comment"><span class="uname"><a href="/' + res.username + '">' + res.username + verifiedTag + '</a></span><span class="cmsg">' + res.message + '</span><span class="cdate">' + res.date + "</span></div>" : comment = '<div class="comment"><span class="uname"><a href="/' + res.username + '">' + res.username + '</a></span><span class="cmsg">' + res.message + '</span><span class="cdate">' + res.date + "</span></div>", $(commentcount).html(Number($(commentcount).text()) + 1), c.append(comment), input.val("")) : console.log("else") })) : console.log("write comment") }

function follow(e) { username = $(e).data("username"), f1 = document.querySelector(".pfollowers"), f2 = document.querySelector(".pfollowings"), url = "/" + username + "/follow/", console.log("follow url => ", url), $.post(url, res => { console.log("follow res: ", res), 0 === res.status ? (message = 'You should login for this <a href="/login">Let\'s login</a>', popup(message, "auto", "warning", 3e3)) : 1 === res.status ? ($(".follow").html("Unfollow"), f1.innerHTML = Number(f1.textContent) + 1) : 2 === res.status ? (f1.innerHTML = Number(f1.textContent) - 1, $(".follow").html("Follow")) : 3 === res.status && Swal.fire({ icon: "error", title: "Oops...", text: res.message }) }) }

function del(e) { val = $(e).parent().parent().parent().parent().attr("data-post-id"), url = "/delete/" + val, $.post(url, res => { 0 === res.status ? (message = "Some errors while delete", popup(message, "popup", "danger")) : 1 === res.status ? ($("div[data-post-id=" + val + "]").removeAttr("data-post-id").remove(), message = "Post deleted successfuly", popup(message, "auto", "success", 5e3)) : 2 === res.status && (message = "Unauthorized process!", popup(message, "popup", "danger")) }) }

function save(e) { val = $(e).parent().parent().parent().parent().attr("data-post-id"), url = "/save/" + val, $.post(url, res => { console.log("save status: ", res), 0 === res.status ? (message = 'You should login for this <a href="/login">Let\'s login</a>', popup(message, "auto", "warning", 3e3)) : 1 === res.status ? $(e).html('<img data-src="/img/saved.svg" class="lazyload" alt="saved-btn">Saved') : 2 === res.status ? $(e).html('<img data-src="/img/save.svg" class="lazyload" alt="save-btn">Save') : 3 === res.status ? (message = res.message, popup(message, "auto", "danger", 3e3)) : (message = "I dont't know but something happened", popup(message, "auto", "danger", 3e3)) }) }

function update(e) {
    $.post("/edit/", $("#updateform").serialize(), res => {
        $(e).attr("disabled", "disabled"), $(".msg").empty(), i = $("input[type=text][name=username]"), adiv = $("div.alts"), adiv.empty();
        var y = $(window).scrollTop();
        if (0 === res.status) message = 'You should login for this <a href="/login">Let\'s login</a>', popup(message, "auto", "warning", 3e3);
        else if (1 === res.status) {
            message = "Successfuly updated.", popup(message, "auto", "success", 3e3);
            let counter = 5,
                interval = setInterval((function() { counter--, $(e).html("Update in (" + counter + "s)"), 0 == counter && ($(e).removeAttr("disabled"), $(e).html("Update"), clearInterval(interval)) }), 1e3)
        } else if (2 === res.status) {
            message = res.message, popup(message, "auto", "danger", 4500);
            let counter = 5,
                interval = setInterval((function() { counter--, $(e).html("Update in (" + counter + "s)"), 0 == counter && ($(e).removeAttr("disabled"), $(e).html("Update"), clearInterval(interval)) }), 1e3)
        } else if (3 === res.status) {
            let alts = res.alternatives;
            f = !0, message = res.message, popup(message, "auto", "danger", 4500);
            let counter = 5,
                interval = setInterval((function() { counter--, $(e).html("Update in (" + counter + "s)"), 0 == counter && ($(e).removeAttr("disabled"), $(e).html("Update"), clearInterval(interval)) }), 1e3);
            alts.forEach(alt => { null !== alt && (f && (f = !1, adiv.append("Some alternatives: ")), a = '<span class="alt">' + alt + "</span>", adiv.append(a)) }), $(".alt").on("click", e => { i.val(e.currentTarget.textContent) }), $(e).removeAttr("disabled")
        }
    })
}

function addpost(e) {
    $.post("/post/", $("#postform").serialize(), res => {
        $(e).attr("disabled", "disabled"), $(".msg").empty().hide();
        var y = $(window).scrollTop(),
            counter = 5;
        if (console.log("post res => ", res), 0 === res.status) message = 'You should login for this <a href="/login">Let\'s login</a>', popup(message, "auto", "warning", 3e3);
        else if (1 === res.status) { message = "Successfuly added post.", popup(message, "auto", "success", 3e3); var interval = setInterval((function() { $(e).html("Post again in (" + counter + "sec)"), 0 == counter && ($(e).removeAttr("disabled"), $(e).html("Post"), clearInterval(interval)), counter-- }), 1e3) } else if (2 === res.status) { message = res.message, popup(message, "auto", "danger", 3e3); var interval = setInterval((function() { $(e).html("Post in (" + counter + "s)"), 0 == counter && ($(e).removeAttr("disabled"), $(e).html("Post"), clearInterval(interval)), counter-- }), 1e3) } else res.status
    })
}

function report(e) { postid = $(e).parent().parent().parent().parent().attr("data-post-id"), url = "/" + postid + "/report/", isrepoted = !0, isrepoted && (isrepoted = !1, $.post(url, res => { 0 === res.status ? (message = 'You should login for this <a href="/login">Let\'s login</a>', popup(message, "auto", "warning", 3e3)) : 1 === res.status ? (message = "Successfuly reported.", popup(message, "auto", "success", 3e3), isrepoted = !1) : 2 === res.status ? (message = "You are already reported.", popup(message, "auto", "warning", 3e3), isrepoted = !1) : 3 === res.status && (message = "There is an error. Please try again later", popup(message, "auto", "danger", 3e3)) })) }
window.onscroll = () => { scrollFunction() }, $(".notif").on("click", e => { "0" != $(".notifications").css("opacity") ? $(".notifications").addClass("active") : $(".notifications").removeClass("active") }), $(".more").on("click", e => { more(e.currentTarget) }), $(".like").on("click", e => { like(e.currentTarget) }), $(".dislike").on("click", e => { dislike(e.currentTarget) }), $(".send").on("click", e => { send(e.currentTarget) }), $.urlParam = function(name) { var results = new RegExp("[?&]" + name + "=([^&#]*)").exec(window.location.href); return null == results ? null : decodeURI(results[1]) || 0 }, "ok" == $.urlParam("status") && Swal.fire({ icon: "success", title: "Success!", text: "Updated successfuly." }), $(".follow").on("click", e => { follow(e.currentTarget) }), $(".del").on("click", e => { del(e.currentTarget) }), $(".save").on("click", e => { save(e.currentTarget) }), $("#textarea").on("keyup", (function() { $("#count").text("Characters left: " + (500 - $(this).val().length)) })), $("#update").on("click", e => { update(e.currentTarget) }), $("#postbtn").on("click", e => { $(".slideToCart").css("transform", "translate(50px, 50px)"), addpost(e.currentTarget) }), $(".report").on("click", e => { console.log("reports are soon") });
let ad = !0;

function search(string) { issearched || (console.log(string), url = "/search", data = { searchData: $("#search").val().trim().toLowerCase() }, $.post(url, data, res => { console.log(res), res && (issearched = !0) })) }

function copyToClipboard(element) {
    var $temp = $("<input>");
    $("body").append($temp), $temp.val($(element).text()).select(), document.execCommand("copy"), $temp.remove()
}

function setCookie(c_name, value, exdays) {
    var exdate = new Date;
    exdate.setDate(exdate.getDate() + exdays);
    var c_value = escape(value) + (null == exdays ? "" : "; expires=" + exdate.toUTCString());
    document.cookie = c_name + "=" + c_value
}

function getCookie(c_name) {
    var i, x, y, ARRcookies = document.cookie.split(";");
    for (i = 0; i < ARRcookies.length; i++)
        if (x = ARRcookies[i].substr(0, ARRcookies[i].indexOf("=")), y = ARRcookies[i].substr(ARRcookies[i].indexOf("=") + 1), (x = x.replace(/^\s+|\s+$/g, "")) == c_name) return unescape(y)
}
$(".notif").on("click", e => {
    url = "/notif/", $(".notifications").toggleClass("active"), $(".ncount").hide(200), ad && "0" == $(".notifications").css("opacity") && (ad = !1, notifloading = $(".notifloading"), notifloading.show(200), ntag = $(".notifications ul"), $.post(url, res => {
        if (console.log("notif res => ", res.status), 0 === res.status) message = 'You should login for this <a href="/login">Let\'s login</a>', popup(message, "auto", "warning", 3e3);
        else if (1 === res.status || 2 == res.status)
            if (notifloading.hide(), 2 === res.status && (ad = !0), result = res.result, result.length > 0) {
                var limit = 11;
                try {
                    result.forEach((n, index) => {
                        switch (uname = res.users[index], uname = uname.length > 11 ? uname.substring(0, 11) + ".." : uname, n.ncode) {
                            case 1:
                                t = '<li><a href="/post/' + n.postid + '"><i class="fas fa-heart"></i><b>\n                  ' + uname + '\n                </b>liked your post </a><span class="ntime">\n                                  ' + res.dates[index] + "\n                                </span></li><hr>", ntag.append(t);
                                break;
                            case 2:
                                t = '<li><a title="Go to ' + uname + '\'s profile" href="/' + uname + '"><i class="fas fa-user-plus"></i><b>\n                    ' + uname + '\n                  </b>started to follow you</a><span title="" class="ntime">\n                                    ' + res.dates[index] + "\n                                  </span></li><hr>", ntag.append(t);
                                break;
                            case 3:
                                t = '<li><a href="/post/' + n.postid + '"><i class="fas fa-comment"></i><b>\n                  ' + uname + '\n                </b> commented on your post</a><span class="ntime">\n                                  ' + res.dates[index] + "\n                                </span></li><hr>", ntag.append(t)
                        }
                    })
                } catch (error) { t = '<li><a href="" onclick="location.reload()">There is an error please refresh the page</a><br>err: ' + error + "</li><hr>", ntag.append(t) }
            } else t = '<li><a href="javascript:void(0)">You have no notification, yet..<i class="far fa-sad-tear"></i></a></li><hr>', ntag.append(t);
        else 3 === res.status && (notifloading.hide(), message = res.message + ' Please <a href="javascript:void(0)" onclick="location.reload()">refresh</a> the page.', popup(message, "popup", "danger"))
    }))
}), markasread = !0, $(".markasread").on("click", () => { markasread && (url = "/markasread", $.post(url, res => { console.log("markasread res =>", res), 0 === res.status ? (message = 'You should login for this <a href="/login">Let\'s login</a>', popup(message, "auto", "warning", 3e3)) : 1 === res.status ? (message = "Successfuly marked as read.", popup(message, "auto", "success", 3e3)) : 2 === res.status && (message = res.message, popup(message, "auto", "danger", 3e3)) })) }), $("#search").on("keyup", e => { 13 === e.keyCode && search($("#search").val()) }), $(".searchbtn").on("click", e => { search($("#search").val()) }), issearched = !1, $(".copy-btn").on("click", () => { copyToClipboard(".link"), message = "Successfully copied to clipboard.", popup(message, "auto", "success", 3e3) }), $(".share").on("click", () => { $(".share-div").addClass("share-active") }), $(".share-close", ".share-div").on("click", () => { $(".share-div").removeClass("share-active") }), $(".report").on("click", () => { $(".report-div").addClass("report-active") }), report_click = !1, $(".report-btn").on("click", e => { report_click || (report_click = !0, tag = e.currentTarget, reportnumber = $(tag).attr("data-report-number"), reporttext = $(tag).text(), postid = $(".report-div .postid").text(), url = "/" + postid + "/report", data = { reportnumber: reportnumber, reporttext: reporttext }, $.post(url, data, res => { console.log("report res =>", res), 0 === res.status ? (message = 'You should login for this <a href="/login">Let\'s login</a>', popup(message, "auto", "warning", 3e3)) : 1 === res.status ? (message = "Successfuly reported. Your reportid: " + res.reportid, popup(message, "popup", "success")) : 2 === res.status && (message = res.message, popup(message, "auto", "danger", 3e3)), report_click = !1 })) }), $(".report-close", ".report-div").on("click", () => { $(".report-div").removeClass("report-active") }), console.log(getCookie("cookieStatus")), getCookie("cookieStatus") && $(".cookie").addClass("cookie-active"), $(".cookie-btn").on("click", () => { $(".cookie").removeClass("cookie-active") });